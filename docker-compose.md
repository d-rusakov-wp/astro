# Что такое docker compose?

Docker Compose — это инструмент для запуска и управления мультиконтейнерными приложениями highload.tech. Он позволяет создать изолированную среду разработки, в которой содержатся все необходимые зависимости проекта, и управлять ею с помощью одной команды.

Основные возможности Docker Compose:
- Запуск нескольких контейнеров одновременно
- Описание взаимодействия между контейнерами в одном файле конфигурации
- Управление сетью между контейнерами
- Управление общими данными через volumes
- Хранение конфиденциальных данных в secrets
- Настройка конфигураций через configs habr.com 

## Процесс работы с Docker Compose состоит из трёх основных шагов:

1. Создание Dockerfile для вашего приложения или выбор готовых образов из Docker Hub
2. Создание файла docker-compose.yml, в котором описываются все сервисы и их взаимодействие
3. Запуск всего приложения одной командой docker compose up

## Особенности работы с Docker Compose:

- Автоматическая загрузка необходимых образов
- Кэширование конфигурации для быстрого обновления
- Возможность создания нескольких изолированных сред на одном хосте
- Защита данных томов при пересоздании контейнеров


# Для чего использовать docker compose?

## Разработка приложений

* Создание изолированной среды разработки с всеми зависимостями
* Автоматизация настройки окружения для новых разработчиков
* Локальное тестирование полной функциональности приложения
* Быстрое обновление зависимостей без влияния на систему разработчика

## Тестирование

* Создание временных сред для автоматизированного тестирования
* Запуск тестов в изолированной среде с необходимыми зависимостями
* Пример использования:
```bash
docker-compose up -d
./run_tests
docker-compose down
```
* Возможность создавать разные конфигурации для разных типов тестов

## Микросервисная архитектура

* Управление несколькими взаимосвязанными сервисами
* Настройка сетей между контейнерами
* Масштабирование отдельных компонентов приложения
* Обработка конфиденциальных данных через secrets

## Продуктивное использование

* Развертывание приложений на продакшн-серверах
* Автоматизация деплоя новых версий
* Управление ресурсами контейнеров
* Мониторинг состояния сервисов

## Особенности применения

* **Гибкость**: возможность создавать разные конфигурации для разных сред
* **Использование переменных**: настройка конфигурации под разные окружения
* **Расширение**: возможность расширять базовые конфигурации для разных случаев использования
* **Автоматизация**: автоматическое управление зависимостями между сервисами

# В чем отличие Compose V1 и Compose V2, что предпочтительней?

## Рекомендации по использованию

### Когда использовать V2:

```bash
# Для новых проектов
docker compose up -d

# Для микросервисных архитектур
docker compose --profile backend up

# С расширенным мониторингом
docker compose top
```

### Когда использовать V1:

```bash
# Если требуется совместимость со старыми системами
docker-compose --compatibility up

# При наличии зависимостей от старых плагинов
docker-compose plugin install ...
```

## Особенности миграции

```markdown
# Рекомендуемый процесс перехода на V2:
1. Обновление Docker до последней версии
2. Проверка совместимости compose файлов
3. Обновление скриптов запуска
4. Тестирование в изолированной среде
```

## Заключение

Compose V2 является предпочтительным выбором для большинства случаев благодаря:
- Встроенной интеграции с Docker CLI
- Лучшей производительности
- Расширенной функциональности
- Улучшенному управлению ресурсами

Однако для проектов с особыми требованиями или зависимостями от старых плагинов может быть целесообразно оставить использование V1.

# Какая команда используется для работы с Compose?

# Основные команды Docker Compose

## Базовые команды

`docker compose up` - запуск контейнеров
```bash
docker compose up -d    # запуск в фоновом режиме
docker compose up --build    # пересборка и запуск
```

`docker compose down` - остановка и удаление контейнеров
```bash
docker compose down    # остановка и удаление
docker compose down --volumes    # удаление включая volumes
```

`docker compose ps` - просмотр состояния контейнеров
```bash
docker compose ps    # список работающих контейнеров
```

`docker compose logs` - просмотр логов
```bash
docker compose logs    # просмотр всех логов
docker compose logs -f    # отслеживание логов в реальном времени
```

## Команды управления

`docker compose start` - запуск остановленных контейнеров
```bash
docker compose start    # запуск всех сервисов
```

`docker compose stop` - остановка работающих контейнеров
```bash
docker compose stop    # остановка всех сервисов
```

`docker compose pause` - приостановка контейнеров
```bash
docker compose pause    # приостановка всех сервисов
```

`docker compose unpause` - возобновление работы контейнеров
```bash
docker compose unpause    # возобновление всех сервисов
```

## Команды для разработки

`docker compose build` - пересборка образов
```bash
docker compose build    # пересборка всех образов
docker compose build --no-cache    # пересборка без кэша
```

`docker compose exec` - выполнение команд в контейнере
```bash
docker compose exec service_name bash    # вход в контейнер
```

# Структура docker-compose.yaml и что там можно указывать.


# Подробней рассказать о содержимом каждого элемента структуры.


# Как общаются сервисы между собой и что для этого нужно сделать?


# Что такое фрагменты(Fragments)?


# Что такое расширения(Extensions)?


# Как заинклюдить docker-compose файлы?


# Как пользоваться профилями?


# Как билдить образы через docker-compose?


# Как указать переменную сервису


# Можно ли подключить файл с переменными


# Как прокинуть порт сервиса


# Как сделать чтобы сервис стартовал после определенного сервиса


# Как сменить CMD у сервиса


# Как запустить в демон режиме и без него?


# Как зайти в контейнер?


# Как посмотреть логи сервиса?


# Как остановить/перезапустить


# Практика
- Описать взаимодействия сервисов: nginx, redis, front (nextjs)
- Так чтобы redis стартовал первым и уже потом только nextjs.
- Описать потребления ресурсов для каждого сервиса.
- Указать переменные в docker-compose для front чтобы они были переопределяемыми.
- front должен проксироваться через nginx (порт 3000)
- должен поддерживаться dev режим с возможностью видеть локальные изменения в файлах
- должна запускаться и проходить продакшн сборка
- прокинуть env переменные из файла в глобальные для контейнера
- в браузере должно открыться приложение по адресу test.127.0.0.1.nip.io